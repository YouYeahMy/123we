<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹é‡å æ’­æ”¾ä¸åˆæˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #ddd;
            font-size: 1.1rem;
        }

        .audio-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .track {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .track h2 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .track h2 i {
            color: #fdbb2d;
        }

        .file-input {
            margin-bottom: 15px;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .volume-control label {
            min-width: 80px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fdbb2d;
            cursor: pointer;
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .visualization {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1.1rem;
        }

        .instructions {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            line-height: 1.6;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #fdbb2d;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .audio-controls {
                flex-direction: column;
            }

            .track {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>éŸ³ä¹é‡å æ’­æ”¾ä¸åˆæˆ</h1>
    <p class="subtitle">ä¸Šä¼ ä¸¤é¦–éŸ³ä¹ï¼Œå®ç°å¹¶è¡Œæ’­æ”¾å’Œå®æ—¶æ··åˆ</p>

    <div class="container">
        <div class="audio-controls">
            <div class="track">
                <h2><i>ğŸµ</i> éŸ³è½¨ 1</h2>
                <div class="file-input">
                    <input type="file" id="file1" accept="audio/*">
                </div>
                <div class="volume-control">
                    <label for="volume1">éŸ³é‡:</label>
                    <input type="range" id="volume1" min="0" max="100" value="80">
                    <span id="volumeValue1">80%</span>
                </div>
                <div class="buttons">
                    <button id="play1">æ’­æ”¾</button>
                    <button id="pause1">æš‚åœ</button>
                    <button id="stop1">åœæ­¢</button>
                </div>
            </div>

            <div class="track">
                <h2><i>ğŸµ</i> éŸ³è½¨ 2</h2>
                <div class="file-input">
                    <input type="file" id="file2" accept="audio/*">
                </div>
                <div class="volume-control">
                    <label for="volume2">éŸ³é‡:</label>
                    <input type="range" id="volume2" min="0" max="100" value="80">
                    <span id="volumeValue2">80%</span>
                </div>
                <div class="buttons">
                    <button id="play2">æ’­æ”¾</button>
                    <button id="pause2">æš‚åœ</button>
                    <button id="stop2">åœæ­¢</button>
                </div>
            </div>
        </div>

        <div class="buttons">
            <button id="playAll">åŒæ—¶æ’­æ”¾ä¸¤é¦–</button>
            <button id="stopAll">åœæ­¢å…¨éƒ¨</button>
        </div>

        <div class="visualization">
            <canvas id="visualizer"></canvas>
        </div>

        <div class="status" id="status">
            è¯·ä¸Šä¼ ä¸¤é¦–éŸ³ä¹æ–‡ä»¶å¼€å§‹æ’­æ”¾
        </div>

        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ul>
                <li>ä¸Šä¼ ä¸¤ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒMP3ã€WAVç­‰æ ¼å¼ï¼‰</li>
                <li>ä½¿ç”¨éŸ³é‡æ»‘å—è°ƒæ•´æ¯ä¸ªéŸ³è½¨çš„éŸ³é‡</li>
                <li>å¯ä»¥å•ç‹¬æ§åˆ¶æ¯ä¸ªéŸ³è½¨çš„æ’­æ”¾ï¼Œä¹Ÿå¯ä»¥åŒæ—¶æ’­æ”¾ä¸¤ä¸ªéŸ³è½¨</li>
                <li>è§‚å¯Ÿå¯è§†åŒ–æ•ˆæœï¼Œæ„Ÿå—ä¸¤é¦–éŸ³ä¹çš„æ··åˆæ•ˆæœ</li>
                <li>æ³¨æ„ï¼šæŸäº›æµè§ˆå™¨å¯èƒ½è¦æ±‚ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾éŸ³é¢‘</li>
            </ul>
        </div>
    </div>

    <script>
        // éŸ³é¢‘ä¸Šä¸‹æ–‡å’ŒèŠ‚ç‚¹
        let audioContext;
        let source1, source2;
        let gainNode1, gainNode2;
        let analyser;
        let dataArray;
        let bufferLength;

        // éŸ³é¢‘ç¼“å†²åŒº
        let audioBuffer1 = null;
        let audioBuffer2 = null;

        // å¯è§†åŒ–
        const canvas = document.getElementById('visualizer');
        const canvasCtx = canvas.getContext('2d');

        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();

                // åˆ›å»ºå¢ç›ŠèŠ‚ç‚¹ç”¨äºæ§åˆ¶éŸ³é‡
                gainNode1 = audioContext.createGain();
                gainNode2 = audioContext.createGain();

                // åˆ›å»ºåˆ†æå™¨ç”¨äºå¯è§†åŒ–
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                // è¿æ¥èŠ‚ç‚¹
                gainNode1.connect(analyser);
                gainNode2.connect(analyser);
                analyser.connect(audioContext.destination);

                // è®¾ç½®åˆå§‹éŸ³é‡
                updateVolume(1, 0.8);
                updateVolume(2, 0.8);

                // å¼€å§‹å¯è§†åŒ–
                visualize();
            }
        }

        // åŠ è½½éŸ³é¢‘æ–‡ä»¶
        function loadAudio(file, trackNumber) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = function(e) {
                    audioContext.decodeAudioData(e.target.result, (buffer) => {
                        if (trackNumber === 1) {
                            audioBuffer1 = buffer;
                        } else {
                            audioBuffer2 = buffer;
                        }
                        resolve(buffer);
                    }, (error) => {
                        reject(error);
                    });
                };

                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // æ’­æ”¾éŸ³é¢‘
        function playAudio(trackNumber) {
            if (!audioContext) {
                initAudioContext();
            }

            const buffer = trackNumber === 1 ? audioBuffer1 : audioBuffer2;
            const gainNode = trackNumber === 1 ? gainNode1 : gainNode2;

            if (!buffer) {
                updateStatus(`éŸ³è½¨ ${trackNumber} æ²¡æœ‰åŠ è½½éŸ³é¢‘æ–‡ä»¶`);
                return;
            }

            // åœæ­¢å½“å‰æ’­æ”¾ï¼ˆå¦‚æœæœ‰ï¼‰
            stopAudio(trackNumber);

            // åˆ›å»ºæ–°çš„éŸ³é¢‘æº
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(gainNode);

            // ä¿å­˜å¼•ç”¨ä»¥ä¾¿åç»­æ§åˆ¶
            if (trackNumber === 1) {
                source1 = source;
            } else {
                source2 = source;
            }

            source.start();
            updateStatus(`éŸ³è½¨ ${trackNumber} å¼€å§‹æ’­æ”¾`);

            source.onended = () => {
                if (trackNumber === 1) {
                    source1 = null;
                } else {
                    source2 = null;
                }
                updateStatus(`éŸ³è½¨ ${trackNumber} æ’­æ”¾ç»“æŸ`);
            };
        }

        // æš‚åœéŸ³é¢‘ï¼ˆå®é™…ä¸ŠWeb Audio APIæ²¡æœ‰æš‚åœï¼Œæˆ‘ä»¬åœæ­¢å¹¶è®°å½•ä½ç½®ï¼‰
        let playbackTime1 = 0;
        let playbackTime2 = 0;
        let startTime1 = 0;
        let startTime2 = 0;

        function pauseAudio(trackNumber) {
            const source = trackNumber === 1 ? source1 : source2;

            if (source) {
                if (trackNumber === 1) {
                    playbackTime1 += audioContext.currentTime - startTime1;
                } else {
                    playbackTime2 += audioContext.currentTime - startTime2;
                }

                source.stop();

                if (trackNumber === 1) {
                    source1 = null;
                } else {
                    source2 = null;
                }

                updateStatus(`éŸ³è½¨ ${trackNumber} å·²æš‚åœ`);
            }
        }

        // åœæ­¢éŸ³é¢‘
        function stopAudio(trackNumber) {
            const source = trackNumber === 1 ? source1 : source2;

            if (source) {
                source.stop();

                if (trackNumber === 1) {
                    source1 = null;
                    playbackTime1 = 0;
                } else {
                    source2 = null;
                    playbackTime2 = 0;
                }
            }
        }

        // æ›´æ–°éŸ³é‡
        function updateVolume(trackNumber, value) {
            const gainNode = trackNumber === 1 ? gainNode1 : gainNode2;
            const volumeValueElement = document.getElementById(`volumeValue${trackNumber}`);

            if (gainNode) {
                // å°†0-100çš„çº¿æ€§å€¼è½¬æ¢ä¸ºå¯¹æ•°éŸ³é‡å€¼
                const volume = value / 100;
                gainNode.gain.value = volume;
                volumeValueElement.textContent = `${value}%`;
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // éŸ³é¢‘å¯è§†åŒ–
        function visualize() {
            if (!analyser) return;

            const width = canvas.width;
            const height = canvas.height;

            requestAnimationFrame(visualize);

            analyser.getByteFrequencyData(dataArray);

            canvasCtx.fillStyle = 'rgb(0, 0, 0)';
            canvasCtx.fillRect(0, 0, width, height);

            const barWidth = (width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;

            for(let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;

                // ä½¿ç”¨æ¸å˜é¢œè‰²
                const gradient = canvasCtx.createLinearGradient(0, height - barHeight, 0, height);
                gradient.addColorStop(0, '#fdbb2d');
                gradient.addColorStop(0.6, '#b21f1f');
                gradient.addColorStop(1, '#1a2a6c');

                canvasCtx.fillStyle = gradient;
                canvasCtx.fillRect(x, height - barHeight, barWidth, barHeight);

                x += barWidth + 1;
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('file1').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                initAudioContext();
                loadAudio(e.target.files[0], 1)
                    .then(() => updateStatus('éŸ³è½¨ 1 åŠ è½½æˆåŠŸ'))
                    .catch(error => updateStatus('éŸ³è½¨ 1 åŠ è½½å¤±è´¥: ' + error.message));
            }
        });

        document.getElementById('file2').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                initAudioContext();
                loadAudio(e.target.files[0], 2)
                    .then(() => updateStatus('éŸ³è½¨ 2 åŠ è½½æˆåŠŸ'))
                    .catch(error => updateStatus('éŸ³è½¨ 2 åŠ è½½å¤±è´¥: ' + error.message));
            }
        });

        document.getElementById('volume1').addEventListener('input', function(e) {
            updateVolume(1, e.target.value);
        });

        document.getElementById('volume2').addEventListener('input', function(e) {
            updateVolume(2, e.target.value);
        });

        document.getElementById('play1').addEventListener('click', function() {
            playAudio(1);
        });

        document.getElementById('play2').addEventListener('click', function() {
            playAudio(2);
        });

        document.getElementById('pause1').addEventListener('click', function() {
            pauseAudio(1);
        });

        document.getElementById('pause2').addEventListener('click', function() {
            pauseAudio(2);
        });

        document.getElementById('stop1').addEventListener('click', function() {
            stopAudio(1);
            updateStatus('éŸ³è½¨ 1 å·²åœæ­¢');
        });

        document.getElementById('stop2').addEventListener('click', function() {
            stopAudio(2);
            updateStatus('éŸ³è½¨ 2 å·²åœæ­¢');
        });

        document.getElementById('playAll').addEventListener('click', function() {
            playAudio(1);
            playAudio(2);
            updateStatus('åŒæ—¶æ’­æ”¾ä¸¤é¦–éŸ³ä¹');
        });

        document.getElementById('stopAll').addEventListener('click', function() {
            stopAudio(1);
            stopAudio(2);
            updateStatus('å…¨éƒ¨éŸ³è½¨å·²åœæ­¢');
        });

        // åˆå§‹åŒ–å¯è§†åŒ–canvaså°ºå¯¸
        function initCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        window.addEventListener('resize', initCanvas);
        initCanvas();
    </script>
</body>
</html>